<!DOCTYPE html>
<html>
<head>
    <title>Pharmacy Catalog Explorer</title>
    <style>
        /* Basic setup for full-height, flexible layout */
        html, body {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            background-color: #f0f2f5;
            box-sizing: border-box;
        }
        
        body.wait {
            cursor: wait !important;
        }

        /* Main container to manage padding and centering */
        .main-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 20px;
            min-height: 0;
            width: 100%;
            max-width: 95%;
            margin: 0 auto;
            box-sizing: border-box;
        }

        .section {
            margin-bottom: 20px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        
        /* Layout containers */
        .layout-container { display: flex; flex-direction: row; gap: 20px; }
        .layout-left { width: 50%; }
        .layout-right { width: 50%; display: flex; flex-direction: column; }
        
        .search-results-container { display: flex; gap: 20px; align-items: flex-start; }
        .search-results-left { flex: 1; }
        .search-results-right { flex: 2; }


        .hidden { display: none !important; }
        
        .status-text { min-height: 20px; margin-top: 5px; font-style: italic; color: #28a745; }

        .disabled, button:disabled { opacity: 0.5; pointer-events: none; background-color: #6c757d; }

        button {
            background-color: #0d6efd;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
            margin-bottom: 10px;
        }
        
        button.clear-btn { background-color: #6c757d; }
        button:hover:not(.disabled) { background-color: #0b5ed7; }
        button.clear-btn:hover:not(.disabled) { background-color: #5c636a; }

        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; table-layout: auto; }
        .detail-table { table-layout: fixed; } /* Specific layout for the 2-column detail view */
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; word-wrap: break-word; }
        th { background-color: #f8f9fa; }
        
        #searchResultsContainer tr:hover { background-color: #f0f2f5; }
        #searchResultsContainer .clickable-row { cursor: pointer; }


        .table-container { max-height: 400px; overflow: auto; border: 1px solid #eee; margin-bottom: 20px; }
        .preview-container:not(:empty) { margin-bottom: 20px; }
        
        #logConsole { width: 100%; flex-grow: 1; box-sizing: border-box; background-color: #2d3748; color: #f7fafc; border: 1px solid #ccc; border-radius: 5px; padding: 10px; font-family: monospace; font-size: 14px; }

        /* Search Page Specific Styles */
        #searchControls { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; }
        #searchControls.loading * { cursor: wait !important; }

        #searchColumnSelect, #searchInput { padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
        #searchInput { flex-grow: 1; }
        
        .detail-table th, .linked-data-table th { width: 30%; font-weight: bold; }

        .double-click-note { font-style: italic; color: #6c757d; margin-top: 10px;}

        .paste-area {
            width: 100%;
            min-height: 100px;
            margin-top: 10px;
            padding: 10px;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px dashed #ccc;
        }
        
        #loadingIndicator {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #6c757d;
        }
        
        #paginationControls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

    </style>
</head>
<body>
<div class="main-container">
    <h2>Pharmacy Catalog Explorer</h2>

    <!-- Two-column layout for loading phase -->
    <div id="loadingLayoutContainer" class="layout-container">
        <!-- Data Loading Section (Left Column) -->
        <div id="loadDataSection" class="section layout-left">
            <h2>Load Data</h2>
            <button id="copyCode1Btn">Copy CCL to Clipboard (Order Catalog Synonym)</button>
            <p id="code1Status" class="status-text"></p>
            <div id="pasteArea1Container" class="hidden">
                <textarea id="pasteArea1" class="paste-area" placeholder="Paste data for Order Catalog Synonym here..."></textarea>
                <button id="processData1Btn">Process Pasted Data (Order Catalog Synonym)</button>
            </div>
            <p id="data1Status" class="status-text"></p>
            <div id="data1PreviewContainer" class="preview-container table-container"></div>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <button id="copyCode2Btn">Copy CCL to Clipboard (PBS Mappings)</button>
            <p id="code2Status" class="status-text"></p>
            <div id="pasteArea2Container" class="hidden">
                <textarea id="pasteArea2" class="paste-area" placeholder="Paste data for PBS Mappings here..."></textarea>
                <button id="processData2Btn">Process Pasted Data (PBS Mappings)</button>
            </div>
            <p id="data2Status" class="status-text"></p>
            <div id="data2PreviewContainer" class="preview-container table-container"></div>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <button id="copyCode3Btn">Copy CCL to Clipboard (Order Catalog)</button>
            <p id="code3Status" class="status-text"></p>
            <div id="pasteArea3Container" class="hidden">
                <textarea id="pasteArea3" class="paste-area" placeholder="Paste data for Order Catalog here..."></textarea>
                <button id="processData3Btn">Process Pasted Data (Order Catalog)</button>
            </div>
            <p id="data3Status" class="status-text"></p>
            <div id="data3PreviewContainer" class="preview-container table-container"></div>
        </div>

        <!-- Console Log Section (Right Column) -->
        <div class="section layout-right">
            <h3>Console Log</h3>
            <textarea id="logConsole" readonly></textarea>
        </div>
    </div>

    <!-- Search and Exploration Section (Initially hidden) -->
    <div id="searchSection" class="section hidden">
        <div id="searchControls">
            <select id="searchColumnSelect"></select>
            <input type="text" id="searchInput" placeholder="Type to search...">
            <button id="searchGoBtn">Go</button>
            <button id="clearSearchBtn" class="clear-btn">Clear</button>
        </div>
        <p id="searchScenarioNote" class="double-click-note"></p>
        <div id="searchResultsContainer" class="table-container">
            <div id="loadingIndicator" class="hidden"><p>Loading...</p></div>
        </div>
        <div id="paginationControls" class="hidden">
             <button id="prevPageBtn">Previous</button>
             <span id="pageInfo"></span>
             <button id="nextPageBtn">Next</button>
        </div>
    </div>
</div>
    <script>
        // --- GLOBAL STATE ---
        let appState = {
            datasets: [],
            datasetNames: ["Order Catalog Synonym", "PBS Mappings", "Order Catalog"],
            columnMetadata: [],
            // Pagination state
            filteredResults: [],
            currentPage: 1,
            rowsPerPage: 50,
        };

        // --- DOM ELEMENT REFERENCES ---
        const loadingLayoutContainer = document.getElementById('loadingLayoutContainer');
        const copyCode1Btn = document.getElementById('copyCode1Btn');
        const pasteArea1Container = document.getElementById('pasteArea1Container');
        const pasteArea1 = document.getElementById('pasteArea1');
        const processData1Btn = document.getElementById('processData1Btn');
        const data1PreviewContainer = document.getElementById('data1PreviewContainer');
        const code1Status = document.getElementById('code1Status');
        const data1Status = document.getElementById('data1Status');
        
        const copyCode2Btn = document.getElementById('copyCode2Btn');
        const pasteArea2Container = document.getElementById('pasteArea2Container');
        const pasteArea2 = document.getElementById('pasteArea2');
        const processData2Btn = document.getElementById('processData2Btn');
        const data2PreviewContainer = document.getElementById('data2PreviewContainer');
        const code2Status = document.getElementById('code2Status');
        const data2Status = document.getElementById('data2Status');
        
        const copyCode3Btn = document.getElementById('copyCode3Btn');
        const pasteArea3Container = document.getElementById('pasteArea3Container');
        const pasteArea3 = document.getElementById('pasteArea3');
        const processData3Btn = document.getElementById('processData3Btn');
        const data3PreviewContainer = document.getElementById('data3PreviewContainer');
        const code3Status = document.getElementById('code3Status');
        const data3Status = document.getElementById('data3Status');

        const searchSection = document.getElementById('searchSection');
        const searchControls = document.getElementById('searchControls');
        const searchColumnSelect = document.getElementById('searchColumnSelect');
        const searchInput = document.getElementById('searchInput');
        const searchGoBtn = document.getElementById('searchGoBtn');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        const searchScenarioNote = document.getElementById('searchScenarioNote');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const paginationControls = document.getElementById('paginationControls');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const pageInfo = document.getElementById('pageInfo');
        
        const logConsole = document.getElementById('logConsole');

        // --- CORE FUNCTIONS ---

        function logMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            logConsole.value += `[${timestamp}] ${message}\n`;
            logConsole.scrollTop = logConsole.scrollHeight;
        }
        
        function copyTextToClipboard(text) {
            return new Promise((resolve, reject) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed"; 
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) resolve();
                    else reject(new Error('Copy command was not successful'));
                } catch (err) {
                    reject(err);
                }
                document.body.removeChild(textArea);
            });
        }

        function copyCode(url) {
            return fetch(url)
                .then(response => response.text())
                .then(text => copyTextToClipboard(text));
        }

        function parseData(text) {
            const lines = text.trim().split('\n');
            if (lines.length < 2) return [];
            const headers = lines[0].split('\t').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split('\t');
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = values[index] ? values[index].trim() : '';
                });
                return obj;
            });
        }
        
        function renderDataTable(container, data, { isClickable = false, onRowClick = null, rowCount = null } = {}) {
            container.innerHTML = '';
            if (!data || data.length === 0) {
                container.innerHTML = '<p>No data to display.</p>';
                return;
            }
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');
            const headerRow = document.createElement('tr');
            
            const headers = Object.keys(data[0]);

            headers.forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            const dataToRender = rowCount ? data.slice(0, rowCount) : data;

            dataToRender.forEach((item) => {
                const row = document.createElement('tr');
                if (isClickable) {
                    row.classList.add('clickable-row');
                    if(onRowClick) {
                       row.onclick = () => onRowClick(item);
                    }
                }
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = item[header];
                    row.appendChild(td);
                })
                tbody.appendChild(row);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }
        
        function setSearchLoadingState(isLoading) {
             if(isLoading) {
                document.body.classList.add('wait');
                searchControls.classList.add('loading');
                [searchInput, searchColumnSelect, searchGoBtn, clearSearchBtn].forEach(el => el.disabled = true);
                searchResultsContainer.innerHTML = '';
                paginationControls.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');
             } else {
                document.body.classList.remove('wait');
                searchControls.classList.remove('loading');
                [searchInput, searchColumnSelect, searchGoBtn, clearSearchBtn].forEach(el => el.disabled = false);
                loadingIndicator.classList.add('hidden');
             }
        }

        function resetApp() {
            appState.datasets = [];
            appState.columnMetadata = [];
            copyCode1Btn.classList.remove('disabled');
            [copyCode2Btn, copyCode3Btn].forEach(btn => btn.classList.add('disabled'));
            [pasteArea1Container, pasteArea2Container, pasteArea3Container, searchSection].forEach(el => el.classList.add('hidden'));
            [code1Status, data1Status, code2Status, data2Status, code3Status, data3Status, 
             data1PreviewContainer, data2PreviewContainer, data3PreviewContainer].forEach(el => el.innerHTML = '');
            [pasteArea1, pasteArea2, pasteArea3].forEach(el => el.value = '');
            
            loadingLayoutContainer.classList.remove('hidden');
            logConsole.value = '';
            logMessage("Application reset. Ready to load data.");
            clearSearch();
        }

        function initializeSearchView() {
            logMessage("All datasets loaded. Initializing search view.");
            loadingLayoutContainer.classList.add('hidden');
            searchSection.classList.remove('hidden');

            searchColumnSelect.innerHTML = '';
            appState.columnMetadata = [];
            
            appState.datasets.forEach((dataset, index) => {
                if (dataset && dataset.length > 0) {
                    const headers = Object.keys(dataset[0]);
                    headers.forEach(header => {
                        const option = document.createElement('option');
                        const label = `${header} - (${appState.datasetNames[index]})`;
                        option.value = appState.columnMetadata.length;
                        option.textContent = label;
                        searchColumnSelect.appendChild(option);
                        appState.columnMetadata.push({ header, datasetIndex: index });
                    });
                }
            });

            const primaryOption = Array.from(searchColumnSelect.options).find(opt => opt.text.startsWith('PRIMARY'));
            if (primaryOption) {
                searchColumnSelect.value = primaryOption.value;
            }
            handleSearch();
        }
        
        function handleSearch() {
            const metadataIndex = searchColumnSelect.value;
            if(!metadataIndex && metadataIndex !== 0) {
                appState.filteredResults = [];
                searchResultsContainer.innerHTML = '';
                paginationControls.classList.add('hidden');
                return;
            };

            setSearchLoadingState(true);
            logMessage(`Searching...`);

            setTimeout(() => {
                const { header, datasetIndex } = appState.columnMetadata[metadataIndex];
                const query = searchInput.value.toLowerCase();
                const sourceData = appState.datasets[datasetIndex];
                
                appState.filteredResults = sourceData.filter(row => row[header] && row[header].toLowerCase().includes(query));
                appState.currentPage = 1;
                
                logMessage(`Found ${appState.filteredResults.length} results.`);
                setSearchLoadingState(false);
                renderCurrentPage();
            }, 10);
        }
        
        function renderCurrentPage() {
            const { filteredResults, currentPage, rowsPerPage } = appState;
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageData = filteredResults.slice(start, end);
            
            if (pageData.length === 0) {
                 searchResultsContainer.innerHTML = '<p>No results found.</p>';
                 renderPaginationControls();
                 return;
            }
            
            const metadataIndex = searchColumnSelect.value;
            const { datasetIndex } = appState.columnMetadata[metadataIndex];
            const isScenario1 = datasetIndex === 0;

            if (isScenario1) {
                searchScenarioNote.textContent = "Click a row to see details and linked data.";
                renderDataTable(searchResultsContainer, pageData, { 
                    isClickable: true,
                    onRowClick: (item) => {
                        const originalIndex = appState.datasets[0].indexOf(item);
                        showItemDetails(originalIndex);
                    }
                });
            } else {
                searchScenarioNote.textContent = "Double-click any cell to copy its value.";
                renderDataTable(searchResultsContainer, pageData);
                 searchResultsContainer.ondblclick = (e) => {
                    if (e.target && e.target.tagName === 'TD') {
                        copyTextToClipboard(e.target.textContent)
                            .then(() => logMessage(`Copied to clipboard: "${e.target.textContent}"`))
                            .catch(() => logMessage(`ERROR: Failed to copy text.`));
                    }
                };
            }
            renderPaginationControls();
        }

        function renderPaginationControls() {
            const { filteredResults, currentPage, rowsPerPage } = appState;
            const totalPages = Math.ceil(filteredResults.length / rowsPerPage);

            if(totalPages <= 1) {
                paginationControls.classList.add('hidden');
                return;
            }

            paginationControls.classList.remove('hidden');
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
        }

        function showItemDetails(itemIndex) {
            const selectedItem = appState.datasets[0][itemIndex];
            searchResultsContainer.innerHTML = '';
            searchScenarioNote.textContent = '';
            paginationControls.classList.add('hidden');

            const wrapper = document.createElement('div');
            wrapper.className = 'search-results-container';

            const detailsContainer = document.createElement('div');
            detailsContainer.className = 'search-results-left';
            detailsContainer.innerHTML = `<h3>Item Details (${appState.datasetNames[0]})</h3>`;
            
            const detailTable = document.createElement('table');
            detailTable.className = 'detail-table';
            const tbody = document.createElement('tbody');
            for(const key in selectedItem) {
                tbody.innerHTML += `<tr><th>${key}</th><td>${selectedItem[key]}</td></tr>`;
            }
            detailTable.appendChild(tbody);
            detailsContainer.appendChild(detailTable);

            const linkedContainer = document.createElement('div');
            linkedContainer.className = 'search-results-right';
            linkedContainer.innerHTML = '<h3>Linked Data</h3>';
            
            appState.datasets.forEach((otherDataset, index) => {
                if (index === 0 || !otherDataset || otherDataset.length === 0) return;

                const primaryHeaders = Object.keys(appState.datasets[0][0]);
                const otherHeaders = Object.keys(otherDataset[0]);
                const commonKeys = primaryHeaders.filter(key => otherHeaders.includes(key));

                for (const linkingKey of commonKeys) {
                    const linkingValue = selectedItem[linkingKey];

                    if (linkingValue && linkingValue.trim() !== '') {
                        const linkedData = otherDataset.filter(row => row[linkingKey] === linkingValue);

                        if(linkedData.length > 0) {
                            const container = document.createElement('div');
                            container.innerHTML = `<h4>From ${appState.datasetNames[index]} (linked by ${linkingKey})</h4>`;
                            renderLinkedData(container, linkedData);
                            linkedContainer.appendChild(container);
                            break; 
                        }
                    }
                }
            });

            if (linkedContainer.querySelectorAll('table').length === 0) {
                 linkedContainer.innerHTML += '<p>No linked data found in other datasets.</p>';
            }

            wrapper.appendChild(detailsContainer);
            wrapper.appendChild(linkedContainer);
            searchResultsContainer.appendChild(wrapper);
        }

        function renderLinkedData(container, data) {
             data.forEach((item, index) => {
                if (index > 0) {
                     container.appendChild(document.createElement('hr'));
                }
                const table = document.createElement('table');
                table.className = 'linked-data-table';
                const tbody = document.createElement('tbody');
                const headers = Object.keys(item);

                for (let i = 0; i < headers.length; i++) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<th>${headers[i]}</th><td>${item[headers[i]]}</td>`;
                    tbody.appendChild(row);
                }
                table.appendChild(tbody);
                container.appendChild(table);
            });
        }

        function clearSearch() {
            searchInput.value = '';
            searchResultsContainer.innerHTML = '';
            searchScenarioNote.textContent = '';
            paginationControls.classList.add('hidden');
            handleSearch();
        }
        
        function setupProcessDataListener(processBtn, pasteArea, statusEl, previewEl, datasetIndex, nextBtn, finalInitFn) {
            processBtn.addEventListener('click', () => {
                const pastedText = pasteArea.value;
                if (!pastedText) {
                    logMessage(`ERROR: Paste area for ${appState.datasetNames[datasetIndex]} is empty.`);
                    statusEl.textContent = 'Please paste data before processing.';
                    statusEl.style.color = 'red';
                    return;
                }

                statusEl.textContent = 'Processing...';
                statusEl.style.color = '#6c757d';
                processBtn.disabled = true;
                document.body.classList.add('wait');
                
                setTimeout(() => {
                    try {
                        const data = parseData(pastedText);
                        if (data.length > 0) {
                            statusEl.textContent = `Data loaded successfully (${data.length} items).`;
                            statusEl.style.color = '#28a745';
                            appState.datasets[datasetIndex] = data;
                            renderDataTable(previewEl, data, { isClickable: false, rowCount: 10 });
                            logMessage(`${appState.datasetNames[datasetIndex]} loaded with ${data.length} items.`);
                            
                            pasteArea.parentElement.classList.add('hidden');

                            if (nextBtn) {
                                nextBtn.classList.remove('disabled');
                            } else if (finalInitFn) {
                                finalInitFn();
                            }
                        } else {
                            statusEl.textContent = 'No data found or failed to parse.';
                            statusEl.style.color = 'red';
                            logMessage(`ERROR: No data parsed from ${appState.datasetNames[datasetIndex]} input.`);
                            processBtn.disabled = false;
                        }
                    } catch (e) {
                         statusEl.textContent = 'An error occurred during parsing.';
                         statusEl.style.color = 'red';
                         logMessage(`FATAL ERROR during parsing: ${e.message}`);
                         processBtn.disabled = false;
                    } finally {
                        document.body.classList.remove('wait');
                    }
                }, 10);
            });
        }


        // --- EVENT LISTENERS ---
        copyCode1Btn.addEventListener('click', () => {
            logMessage("Copying Order Catalog Synonym CCL code...");
            copyCode("https://raw.githubusercontent.com/neoversionsix/custom-ccl-jobs/refs/heads/main/QUERIES/QUERIES%20FOR%20SPECIFIC%20TOOLS/PHARMACY%20CATALOG%20EXPLORER/Pharmacy%20Order%20Catalog%20Synonym.ccl")
                .then(() => {
                    code1Status.textContent = 'Code copied. Run it, copy the output, and paste it below.';
                    copyCode1Btn.classList.add('disabled');
                    pasteArea1Container.classList.remove('hidden');
                    logMessage("Order Catalog Synonym CCL code copied. Please paste data below.");
                })
                .catch(err => logMessage("ERROR: Failed to copy code."));
        });
        
        copyCode2Btn.addEventListener('click', () => {
            logMessage("Copying PBS Mappings CCL code...");
            copyCode("https://raw.githubusercontent.com/neoversionsix/custom-ccl-jobs/refs/heads/main/QUERIES/QUERIES%20FOR%20SPECIFIC%20TOOLS/PHARMACY%20CATALOG%20EXPLORER/PBS%20mappings.ccl")
                .then(() => {
                    code2Status.textContent = 'Code copied. Run it, copy the output, and paste it below.';
                    copyCode2Btn.classList.add('disabled');
                    pasteArea2Container.classList.remove('hidden');
                    logMessage("PBS Mappings CCL code copied. Please paste data below.");
                })
                .catch(err => logMessage("ERROR: Failed to copy code."));
        });

        copyCode3Btn.addEventListener('click', () => {
            logMessage("Copying Order Catalog CCL code...");
            copyCode("https://raw.githubusercontent.com/neoversionsix/custom-ccl-jobs/refs/heads/main/QUERIES/QUERIES%20FOR%20SPECIFIC%20TOOLS/PHARMACY%20CATALOG%20EXPLORER/Pharmacy%20Order%20Catalog.ccl")
                .then(() => {
                    code3Status.textContent = 'Code copied. Run it, copy the output, and paste it below.';
                    copyCode3Btn.classList.add('disabled');
                    pasteArea3Container.classList.remove('hidden');
                    logMessage("Order Catalog CCL code copied. Please paste data below.");
                })
                .catch(err => logMessage("ERROR: Failed to copy code."));
        });
        
        setupProcessDataListener(processData1Btn, pasteArea1, data1Status, data1PreviewContainer, 0, copyCode2Btn, null);
        setupProcessDataListener(processData2Btn, pasteArea2, data2Status, data2PreviewContainer, 1, copyCode3Btn, null);
        setupProcessDataListener(processData3Btn, pasteArea3, data3Status, data3PreviewContainer, 2, null, initializeSearchView);


        searchGoBtn.addEventListener('click', handleSearch);
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleSearch();
        });
        searchColumnSelect.addEventListener('change', () => {
            searchInput.value = '';
            handleSearch();
        });
        clearSearchBtn.addEventListener('click', clearSearch);
        
        prevPageBtn.addEventListener('click', () => {
            if(appState.currentPage > 1) {
                appState.currentPage--;
                renderCurrentPage();
            }
        });
        
        nextPageBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(appState.filteredResults.length / appState.rowsPerPage);
            if(appState.currentPage < totalPages) {
                appState.currentPage++;
                renderCurrentPage();
            }
        });
        
        document.addEventListener('DOMContentLoaded', resetApp);
    </script>
</body>
</html>
